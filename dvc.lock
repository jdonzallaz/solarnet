schema: '2.0'
stages:
  download-dataset:
    cmd: python -m solarnet.main download sdo-benchmark-zip
    deps:
    - path: config/minio.yaml
      md5: 2cf2c6bc04bcddb76df1d97aae80ba0a
      size: 117
    outs:
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
  train@binary:
    cmd: python -m solarnet.main train +experiment=binary_classification
    deps:
    - path: config/experiment/binary_classification.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: 05894cb899be21c19105ff28a8306879
      size: 3436
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/config.yaml
      md5: 1a3604eaed083c5b7b32c32fae023309
      size: 392
    - path: models/binary/history.png
      md5: c303fb8bf6e102770918c2ee1b62711b
      size: 52439
    - path: models/binary/metadata.yaml
      md5: 204625c20abdbef1608f92f62413b1b2
      size: 348
    - path: models/binary/model.ckpt
      md5: 7e55e920514cb9ffe6cf36f85f17d83c
      size: 321812
    - path: models/binary/model_summary.txt
      md5: d2a8c1d8bcf0840f821abc096ff30489
      size: 1702
  test@binary:
    cmd: python -m solarnet.main test +experiment=binary_classification
    deps:
    - path: config/experiment/binary_classification.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary/model.ckpt
      md5: 7e55e920514cb9ffe6cf36f85f17d83c
      size: 321812
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 2aec85f75a53bd4e5fba44a2f7928573
      size: 5628
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/confusion_matrix.png
      md5: 8acd97c4fc687be19e99042df945191e
      size: 21932
    - path: models/binary/metrics.yaml
      md5: 2f564f4932d5283f6024eadb6be78966
      size: 210
    - path: models/binary/test_samples.png
      md5: 7da1c3d228ad1971da1a38fe7818bea2
      size: 758799
  generate-report@binary:
    cmd: printf "# Model report\n" > models/binary/report.md && printf "## Training\n"
      >> models/binary/report.md && printf "### Parameters\n" >> models/binary/report.md
      && printf '```yaml\n' >> models/binary/report.md && cat models/binary/config.yaml
      >> models/binary/report.md && printf '```\n' >> models/binary/report.md && printf
      "### Model architecture\n" >> models/binary/report.md && printf '```\n' >> models/binary/report.md
      && cat models/binary/model_summary.txt >> models/binary/report.md && printf
      '```\n' >> models/binary/report.md && printf "### Loss curve\n" >> models/binary/report.md
      && printf "![Loss curve](history.png 'Loss curve')\n\n" >> models/binary/report.md
      && printf "### Metadata\n" >> models/binary/report.md && printf '```yaml\n'
      >> models/binary/report.md && cat models/binary/metadata.yaml >> models/binary/report.md
      && printf '```\n' >> models/binary/report.md && printf "## Test\n" >> models/binary/report.md
      && printf "### Metrics\n" >> models/binary/report.md && dvc metrics show --show-md
      models/binary/metrics.yaml >> models/binary/report.md && printf "### Confusion
      matrix\n" >> models/binary/report.md && printf "![Confusion matrix](confusion_matrix.png
      'Confusion matrix')\n\n" >> models/binary/report.md && printf "### Test samples\n"
      >> models/binary/report.md && printf "![Test samples](test_samples.png 'Test
      samples')\n\n" >> models/binary/report.md
    deps:
    - path: models/binary/config.yaml
      md5: 1a3604eaed083c5b7b32c32fae023309
      size: 392
    - path: models/binary/confusion_matrix.png
      md5: 8acd97c4fc687be19e99042df945191e
      size: 21932
    - path: models/binary/history.png
      md5: c303fb8bf6e102770918c2ee1b62711b
      size: 52439
    - path: models/binary/metrics.yaml
      md5: 2f564f4932d5283f6024eadb6be78966
      size: 210
    - path: models/binary/model_summary.txt
      md5: d2a8c1d8bcf0840f821abc096ff30489
      size: 1702
    - path: models/binary/test_samples.png
      md5: 7da1c3d228ad1971da1a38fe7818bea2
      size: 758799
    outs:
    - path: models/binary/report.md
      md5: c3d8faf7ddfc2d1264e08967933bba76
      size: 3157
  train@multiclass:
    cmd: python -m solarnet.main train +experiment=multiclass_classification
    deps:
    - path: config/experiment/multiclass_classification.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: 05894cb899be21c19105ff28a8306879
      size: 3436
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/config.yaml
      md5: db8330cb3cdd7c2c57cd7890aadf654b
      size: 428
    - path: models/multiclass/history.png
      md5: 993765b390c3e7fc4271545a31d03453
      size: 36195
    - path: models/multiclass/metadata.yaml
      md5: 0508b1efff8c5918d3539301f063808d
      size: 347
    - path: models/multiclass/model.ckpt
      md5: bdfabf42bd7bd5988b9a83893f29318c
      size: 322196
    - path: models/multiclass/model_summary.txt
      md5: 6ed4bd423e1e54a4258cbbd982fa31ed
      size: 1702
  test@multiclass:
    cmd: python -m solarnet.main test +experiment=multiclass_classification
    deps:
    - path: config/experiment/multiclass_classification.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/multiclass/model.ckpt
      md5: bdfabf42bd7bd5988b9a83893f29318c
      size: 322196
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 2aec85f75a53bd4e5fba44a2f7928573
      size: 5628
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/confusion_matrix.png
      md5: f89a1fd4033fedbf1181b4812c249d17
      size: 41159
    - path: models/multiclass/metrics.yaml
      md5: 51f6db537a011c3807eb91e68a1db8a0
      size: 213
    - path: models/multiclass/test_samples.png
      md5: b09013da9086dfcf314213facd657614
      size: 765574
  generate-report@multiclass:
    cmd: printf "# Model report\n" > models/multiclass/report.md && printf "## Training\n"
      >> models/multiclass/report.md && printf "### Parameters\n" >> models/multiclass/report.md
      && printf '```yaml\n' >> models/multiclass/report.md && cat models/multiclass/config.yaml
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Model architecture\n" >> models/multiclass/report.md && printf
      '```\n' >> models/multiclass/report.md && cat models/multiclass/model_summary.txt
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Loss curve\n" >> models/multiclass/report.md && printf "![Loss
      curve](history.png 'Loss curve')\n\n" >> models/multiclass/report.md && printf
      "### Metadata\n" >> models/multiclass/report.md && printf '```yaml\n' >> models/multiclass/report.md
      && cat models/multiclass/metadata.yaml >> models/multiclass/report.md && printf
      '```\n' >> models/multiclass/report.md && printf "## Test\n" >> models/multiclass/report.md
      && printf "### Metrics\n" >> models/multiclass/report.md && dvc metrics show
      --show-md models/multiclass/metrics.yaml >> models/multiclass/report.md && printf
      "### Confusion matrix\n" >> models/multiclass/report.md && printf "![Confusion
      matrix](confusion_matrix.png 'Confusion matrix')\n\n" >> models/multiclass/report.md
      && printf "### Test samples\n" >> models/multiclass/report.md && printf "![Test
      samples](test_samples.png 'Test samples')\n\n" >> models/multiclass/report.md
    deps:
    - path: models/multiclass/config.yaml
      md5: db8330cb3cdd7c2c57cd7890aadf654b
      size: 428
    - path: models/multiclass/confusion_matrix.png
      md5: f89a1fd4033fedbf1181b4812c249d17
      size: 41159
    - path: models/multiclass/history.png
      md5: 993765b390c3e7fc4271545a31d03453
      size: 36195
    - path: models/multiclass/metrics.yaml
      md5: 51f6db537a011c3807eb91e68a1db8a0
      size: 213
    - path: models/multiclass/model_summary.txt
      md5: 6ed4bd423e1e54a4258cbbd982fa31ed
      size: 1702
    - path: models/multiclass/test_samples.png
      md5: b09013da9086dfcf314213facd657614
      size: 765574
    outs:
    - path: models/multiclass/report.md
      md5: 8325e1ca6495700b1dc747d5fb4bfe13
      size: 3204
  train@regression:
    cmd: python -m solarnet.main train +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 106
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 2944
    - path: solarnet/tasks/train.py
      md5: 05894cb899be21c19105ff28a8306879
      size: 3436
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/config.yaml
      md5: 61d0368ab5997554d02de3f7acbc3069
      size: 340
    - path: models/regression/history.png
      md5: 61c2e5ef5b26e17d87d20446e70919af
      size: 30374
    - path: models/regression/metadata.yaml
      md5: bcfcd83552e383950c30b00394823ec2
      size: 348
    - path: models/regression/model.ckpt
      md5: 79f3259affda5afc970464cad83fddca
      size: 322187
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1681
  test@regression:
    cmd: python -m solarnet.main test +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 106
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/regression/model.ckpt
      md5: 79f3259affda5afc970464cad83fddca
      size: 322187
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 2944
    - path: solarnet/tasks/test.py
      md5: 2aec85f75a53bd4e5fba44a2f7928573
      size: 5628
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/metrics.yaml
      md5: 009540457cddf78ae77c11154c3c72ec
      size: 55
    - path: models/regression/regression_line.png
      md5: f9d7d36a93a0eeabad83eff020bf72bf
      size: 69191
    - path: models/regression/test_samples.png
      md5: 048f7855bdc47dd792cf55d803c44fd7
      size: 758941
  generate-report@regression:
    cmd: printf "# Model report\n" > models/regression/report.md && printf "## Training\n"
      >> models/regression/report.md && printf "### Parameters\n" >> models/regression/report.md
      && printf '```yaml\n' >> models/regression/report.md && cat models/regression/config.yaml
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Model architecture\n" >> models/regression/report.md && printf
      '```\n' >> models/regression/report.md && cat models/regression/model_summary.txt
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Loss curve\n" >> models/regression/report.md && printf "![Loss
      curve](history.png 'Loss curve')\n\n" >> models/regression/report.md && printf
      "### Metadata\n" >> models/regression/report.md && printf '```yaml\n' >> models/regression/report.md
      && cat models/regression/metadata.yaml >> models/regression/report.md && printf
      '```\n' >> models/regression/report.md && printf "## Test\n" >> models/regression/report.md
      && printf "### Metrics\n" >> models/regression/report.md && dvc metrics show
      --show-md models/regression/metrics.yaml >> models/regression/report.md && printf
      "### Regression line\n" >> models/regression/report.md && printf "![Regression
      line](regression_line.png 'Regression line')\n\n" >> models/regression/report.md
      && printf "### Test samples\n" >> models/regression/report.md && printf "![Test
      samples](test_samples.png 'Test samples')\n\n" >> models/regression/report.md
    deps:
    - path: models/regression/config.yaml
      md5: 61d0368ab5997554d02de3f7acbc3069
      size: 340
    - path: models/regression/history.png
      md5: 61c2e5ef5b26e17d87d20446e70919af
      size: 30374
    - path: models/regression/metrics.yaml
      md5: 009540457cddf78ae77c11154c3c72ec
      size: 55
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1681
    - path: models/regression/regression_line.png
      md5: f9d7d36a93a0eeabad83eff020bf72bf
      size: 69191
    - path: models/regression/test_samples.png
      md5: 048f7855bdc47dd792cf55d803c44fd7
      size: 758941
    outs:
    - path: models/regression/report.md
      md5: 59d1727a8c81767624f91d9262a61c20
      size: 2855
  test@binary_sdodataset:
    cmd: python -m solarnet.main test +experiment=binary_sdodataset
    deps:
    - path: config/experiment/binary_sdodataset.yaml
      md5: 3f1e40f1f1f6ca2f5e625f7996d4008e
      size: 143
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary_sdodataset/model.ckpt
      md5: 213c3dd5e817c3513b64d2f9155c1382
      size: 326996
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 2aec85f75a53bd4e5fba44a2f7928573
      size: 5628
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary_sdodataset/confusion_matrix.png
      md5: 46e955e4edc5aab8bb8ae1417d92a772
      size: 22090
    - path: models/binary_sdodataset/metrics.yaml
      md5: c7c6dbcba1c9cfacb82767817ab8cc4a
      size: 212
    - path: models/binary_sdodataset/test_samples.png
      md5: cf77093d1a1006302304557f55c8695b
      size: 431985
  train@binary_sdodataset:
    cmd: python -m solarnet.main train +experiment=binary_sdodataset
    deps:
    - path: config/experiment/binary_sdodataset.yaml
      md5: 3f1e40f1f1f6ca2f5e625f7996d4008e
      size: 143
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: 05894cb899be21c19105ff28a8306879
      size: 3436
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary_sdodataset/config.yaml
      md5: 220b55374388344a14fb09fe548ec7f1
      size: 369
    - path: models/binary_sdodataset/history.png
      md5: e3f48599f537c7f0d6b93ff9050de371
      size: 41440
    - path: models/binary_sdodataset/metadata.yaml
      md5: 5f1183814a0bf69ada2c2a573a5a97c7
      size: 348
    - path: models/binary_sdodataset/model.ckpt
      md5: 213c3dd5e817c3513b64d2f9155c1382
      size: 326996
    - path: models/binary_sdodataset/model_summary.txt
      md5: f4659c7295d32e213ae8135fc795071c
      size: 1702
  generate-report@binary_sdodataset:
    cmd: printf "# Model report\n" > models/binary_sdodataset/report.md && printf
      "## Training\n" >> models/binary_sdodataset/report.md && printf "### Parameters\n"
      >> models/binary_sdodataset/report.md && printf '```yaml\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/config.yaml >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "### Model
      architecture\n" >> models/binary_sdodataset/report.md && printf '```\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/model_summary.txt >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "### Loss
      curve\n" >> models/binary_sdodataset/report.md && printf "![Loss curve](history.png
      'Loss curve')\n\n" >> models/binary_sdodataset/report.md && printf "### Metadata\n"
      >> models/binary_sdodataset/report.md && printf '```yaml\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/metadata.yaml >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "## Test\n"
      >> models/binary_sdodataset/report.md && printf "### Metrics\n" >> models/binary_sdodataset/report.md
      && dvc metrics show --show-md models/binary_sdodataset/metrics.yaml >> models/binary_sdodataset/report.md
      && printf "### Confusion matrix\n" >> models/binary_sdodataset/report.md &&
      printf "![Confusion matrix](confusion_matrix.png 'Confusion matrix')\n\n" >>
      models/binary_sdodataset/report.md && printf "### Test samples\n" >> models/binary_sdodataset/report.md
      && printf "![Test samples](test_samples.png 'Test samples')\n\n" >> models/binary_sdodataset/report.md
    deps:
    - path: models/binary_sdodataset/config.yaml
      md5: 220b55374388344a14fb09fe548ec7f1
      size: 369
    - path: models/binary_sdodataset/confusion_matrix.png
      md5: 46e955e4edc5aab8bb8ae1417d92a772
      size: 22090
    - path: models/binary_sdodataset/history.png
      md5: e3f48599f537c7f0d6b93ff9050de371
      size: 41440
    - path: models/binary_sdodataset/metrics.yaml
      md5: c7c6dbcba1c9cfacb82767817ab8cc4a
      size: 212
    - path: models/binary_sdodataset/model_summary.txt
      md5: f4659c7295d32e213ae8135fc795071c
      size: 1702
    - path: models/binary_sdodataset/test_samples.png
      md5: cf77093d1a1006302304557f55c8695b
      size: 431985
    outs:
    - path: models/binary_sdodataset/report.md
      md5: 199e245bd310a92edd1dc0441be13bf5
      size: 3161
