schema: '2.0'
stages:
  download-dataset:
    cmd: python -m solarnet.main download sdo-benchmark-zip
    deps:
    - path: config/minio.yaml
      md5: 2cf2c6bc04bcddb76df1d97aae80ba0a
      size: 117
    outs:
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
  train@binary:
    cmd: python -m solarnet.main train +experiment=binary_classification
    deps:
    - path: config/experiment/binary_classification.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: f595440bb73aafd5d889d33757f667b4
      size: 5156
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/config.yaml
      md5: 39c5ac78deb4573729f61727974249d6
      size: 344
    - path: models/binary/history.png
      md5: a4c658b44edc3bff8a69a2acd0317a8e
      size: 49972
    - path: models/binary/metadata.yaml
      md5: 0fbd848878d984c791e9c48443edf52b
      size: 339
    - path: models/binary/model.ckpt
      md5: 11925634eb21830ece25751e33d06ea0
      size: 321812
    - path: models/binary/model_summary.txt
      md5: d2a8c1d8bcf0840f821abc096ff30489
      size: 1702
  test@binary:
    cmd: python -m solarnet.main test +experiment=binary_classification
    deps:
    - path: config/experiment/binary_classification.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary/model.ckpt
      md5: 11925634eb21830ece25751e33d06ea0
      size: 321812
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: db54cdc97ae0b881fea979c3751b4709
      size: 6520
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/confusion_matrix.png
      md5: c050e92bd5d7e2300c24b47e17c97bd3
      size: 21714
    - path: models/binary/metrics.yaml
      md5: cf0d261bc5024d07682fc68d0a42a750
      size: 194
    - path: models/binary/test_samples.png
      md5: fe209658ea12ec9c5b3dfeba3a27e001
      size: 755993
  generate-report@binary:
    cmd: printf "# Model report\n" > models/binary/report.md && printf "## Training\n"
      >> models/binary/report.md && printf "### Parameters\n" >> models/binary/report.md
      && printf '```yaml\n' >> models/binary/report.md && cat models/binary/config.yaml
      >> models/binary/report.md && printf '```\n' >> models/binary/report.md && printf
      "### Model architecture\n" >> models/binary/report.md && printf '```\n' >> models/binary/report.md
      && cat models/binary/model_summary.txt >> models/binary/report.md && printf
      '```\n' >> models/binary/report.md && printf "### Loss curve\n" >> models/binary/report.md
      && printf "![Loss curve](history.png 'Loss curve')\n\n" >> models/binary/report.md
      && printf "### Metadata\n" >> models/binary/report.md && printf '```yaml\n'
      >> models/binary/report.md && cat models/binary/metadata.yaml >> models/binary/report.md
      && printf '```\n' >> models/binary/report.md && printf "## Test\n" >> models/binary/report.md
      && printf "### Metrics\n" >> models/binary/report.md && dvc metrics show --show-md
      models/binary/metrics.yaml >> models/binary/report.md && printf "### Confusion
      matrix\n" >> models/binary/report.md && printf "![Confusion matrix](confusion_matrix.png
      'Confusion matrix')\n\n" >> models/binary/report.md && printf "### Test samples\n"
      >> models/binary/report.md && printf "![Test samples](test_samples.png 'Test
      samples')\n\n" >> models/binary/report.md
    deps:
    - path: models/binary/config.yaml
      md5: 39c5ac78deb4573729f61727974249d6
      size: 344
    - path: models/binary/confusion_matrix.png
      md5: c050e92bd5d7e2300c24b47e17c97bd3
      size: 21714
    - path: models/binary/history.png
      md5: a4c658b44edc3bff8a69a2acd0317a8e
      size: 49972
    - path: models/binary/metrics.yaml
      md5: cf0d261bc5024d07682fc68d0a42a750
      size: 194
    - path: models/binary/model_summary.txt
      md5: d2a8c1d8bcf0840f821abc096ff30489
      size: 1702
    - path: models/binary/test_samples.png
      md5: fe209658ea12ec9c5b3dfeba3a27e001
      size: 755993
    outs:
    - path: models/binary/report.md
      md5: f94d0b28f8ba917220b20b7cabb71bc0
      size: 3091
  train@multiclass:
    cmd: python -m solarnet.main train +experiment=multiclass_classification
    deps:
    - path: config/experiment/multiclass_classification.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: f595440bb73aafd5d889d33757f667b4
      size: 5156
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/config.yaml
      md5: 391f3b5da41eab5cb94a84e6281e92d0
      size: 379
    - path: models/multiclass/history.png
      md5: 8bf862a86484b320bc4af203f5a74bfc
      size: 33549
    - path: models/multiclass/metadata.yaml
      md5: 0b541460ef420e86787b65ade24edbae
      size: 321
    - path: models/multiclass/model.ckpt
      md5: 0faa87ea36e199aff346d5e1ff46d516
      size: 322196
    - path: models/multiclass/model_summary.txt
      md5: 6ed4bd423e1e54a4258cbbd982fa31ed
      size: 1702
  test@multiclass:
    cmd: python -m solarnet.main test +experiment=multiclass_classification
    deps:
    - path: config/experiment/multiclass_classification.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/multiclass/model.ckpt
      md5: 0faa87ea36e199aff346d5e1ff46d516
      size: 322196
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: db54cdc97ae0b881fea979c3751b4709
      size: 6520
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/confusion_matrix.png
      md5: ce6983662c8af25f30dd64fe6283fb8d
      size: 38907
    - path: models/multiclass/metrics.yaml
      md5: c57dd79b84573324860474dc7baaa3c9
      size: 209
    - path: models/multiclass/test_samples.png
      md5: 7b5b064bab16d8df01c86bd8c5b465b3
      size: 759877
  generate-report@multiclass:
    cmd: printf "# Model report\n" > models/multiclass/report.md && printf "## Training\n"
      >> models/multiclass/report.md && printf "### Parameters\n" >> models/multiclass/report.md
      && printf '```yaml\n' >> models/multiclass/report.md && cat models/multiclass/config.yaml
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Model architecture\n" >> models/multiclass/report.md && printf
      '```\n' >> models/multiclass/report.md && cat models/multiclass/model_summary.txt
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Loss curve\n" >> models/multiclass/report.md && printf "![Loss
      curve](history.png 'Loss curve')\n\n" >> models/multiclass/report.md && printf
      "### Metadata\n" >> models/multiclass/report.md && printf '```yaml\n' >> models/multiclass/report.md
      && cat models/multiclass/metadata.yaml >> models/multiclass/report.md && printf
      '```\n' >> models/multiclass/report.md && printf "## Test\n" >> models/multiclass/report.md
      && printf "### Metrics\n" >> models/multiclass/report.md && dvc metrics show
      --show-md models/multiclass/metrics.yaml >> models/multiclass/report.md && printf
      "### Confusion matrix\n" >> models/multiclass/report.md && printf "![Confusion
      matrix](confusion_matrix.png 'Confusion matrix')\n\n" >> models/multiclass/report.md
      && printf "### Test samples\n" >> models/multiclass/report.md && printf "![Test
      samples](test_samples.png 'Test samples')\n\n" >> models/multiclass/report.md
    deps:
    - path: models/multiclass/config.yaml
      md5: 391f3b5da41eab5cb94a84e6281e92d0
      size: 379
    - path: models/multiclass/confusion_matrix.png
      md5: ce6983662c8af25f30dd64fe6283fb8d
      size: 38907
    - path: models/multiclass/history.png
      md5: 8bf862a86484b320bc4af203f5a74bfc
      size: 33549
    - path: models/multiclass/metrics.yaml
      md5: c57dd79b84573324860474dc7baaa3c9
      size: 209
    - path: models/multiclass/model_summary.txt
      md5: 6ed4bd423e1e54a4258cbbd982fa31ed
      size: 1702
    - path: models/multiclass/test_samples.png
      md5: 7b5b064bab16d8df01c86bd8c5b465b3
      size: 759877
    outs:
    - path: models/multiclass/report.md
      md5: 1ef2d27c9932a7b413015ebe6b2b05f1
      size: 3129
  train@regression:
    cmd: python -m solarnet.main train +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 106
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 2944
    - path: solarnet/tasks/train.py
      md5: f595440bb73aafd5d889d33757f667b4
      size: 5156
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/config.yaml
      md5: 916b90d1dff46bca183d07ec0ed8f752
      size: 291
    - path: models/regression/history.png
      md5: 1511814ea606baeff78bfb3fadc5fba1
      size: 27355
    - path: models/regression/metadata.yaml
      md5: 1b615a60546d8aeafeb2bb532cad4e79
      size: 320
    - path: models/regression/model.ckpt
      md5: 03d21bd632d56fcb9476e0f635094766
      size: 322251
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1681
  test@regression:
    cmd: python -m solarnet.main test +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 106
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/regression/model.ckpt
      md5: 03d21bd632d56fcb9476e0f635094766
      size: 322251
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 2944
    - path: solarnet/tasks/test.py
      md5: db54cdc97ae0b881fea979c3751b4709
      size: 6520
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/metrics.yaml
      md5: e5c11ba2cd8c4a8f69d2a6ce003bea27
      size: 55
    - path: models/regression/regression_line.png
      md5: bc79c03a511ff862222283d650e558af
      size: 68242
    - path: models/regression/test_samples.png
      md5: 5f41901178402d69a6de2e7d3a72cb4c
      size: 765296
  generate-report@regression:
    cmd: printf "# Model report\n" > models/regression/report.md && printf "## Training\n"
      >> models/regression/report.md && printf "### Parameters\n" >> models/regression/report.md
      && printf '```yaml\n' >> models/regression/report.md && cat models/regression/config.yaml
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Model architecture\n" >> models/regression/report.md && printf
      '```\n' >> models/regression/report.md && cat models/regression/model_summary.txt
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Loss curve\n" >> models/regression/report.md && printf "![Loss
      curve](history.png 'Loss curve')\n\n" >> models/regression/report.md && printf
      "### Metadata\n" >> models/regression/report.md && printf '```yaml\n' >> models/regression/report.md
      && cat models/regression/metadata.yaml >> models/regression/report.md && printf
      '```\n' >> models/regression/report.md && printf "## Test\n" >> models/regression/report.md
      && printf "### Metrics\n" >> models/regression/report.md && dvc metrics show
      --show-md models/regression/metrics.yaml >> models/regression/report.md && printf
      "### Regression line\n" >> models/regression/report.md && printf "![Regression
      line](regression_line.png 'Regression line')\n\n" >> models/regression/report.md
      && printf "### Test samples\n" >> models/regression/report.md && printf "![Test
      samples](test_samples.png 'Test samples')\n\n" >> models/regression/report.md
    deps:
    - path: models/regression/config.yaml
      md5: 916b90d1dff46bca183d07ec0ed8f752
      size: 291
    - path: models/regression/history.png
      md5: 1511814ea606baeff78bfb3fadc5fba1
      size: 27355
    - path: models/regression/metrics.yaml
      md5: e5c11ba2cd8c4a8f69d2a6ce003bea27
      size: 55
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1681
    - path: models/regression/regression_line.png
      md5: bc79c03a511ff862222283d650e558af
      size: 68242
    - path: models/regression/test_samples.png
      md5: 5f41901178402d69a6de2e7d3a72cb4c
      size: 765296
    outs:
    - path: models/regression/report.md
      md5: 400c6513077a114543c2aad7f6b2365d
      size: 2778
