schema: '2.0'
stages:
  download-dataset:
    cmd: python -m solarnet.main download sdo-benchmark-zip
    deps:
    - path: config/minio.yaml
      md5: 2cf2c6bc04bcddb76df1d97aae80ba0a
      size: 117
    outs:
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
  train@binary:
    cmd: python -m solarnet.main train +experiment=binary
    deps:
    - path: config/experiment/binary.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 61
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/config.yaml
      md5: 1a3604eaed083c5b7b32c32fae023309
      size: 416
    - path: models/binary/metadata.yaml
      md5: ebf109c16130200b6789c1d2c9eab24a
      size: 332
    - path: models/binary/model.ckpt
      md5: 18848b95483caa980762a7b52af3f21c
      size: 321751
    - path: models/binary/model_summary.txt
      md5: 978717ff182a8abda1a95baef1a7b554
      size: 1831
    - path: models/binary/train_plots/
      md5: 05ac4a43c043f18712aac9a69d35cb52.dir
      size: 90529
      nfiles: 2
  test@binary:
    cmd: python -m solarnet.main test +experiment=binary
    deps:
    - path: config/experiment/binary.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 61
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary/model.ckpt
      md5: 18848b95483caa980762a7b52af3f21c
      size: 321751
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/tasks/test.py
      md5: e6b52f4bd6de4376e21088a7f195524f
      size: 6355
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/metrics.yaml
      md5: 8338197163dc2f6a577045db94dff2b5
      size: 245
    - path: models/binary/test_plots/
      md5: 7a95bf1e396c078b294d905a1547e2e7.dir
      size: 813339
      nfiles: 3
  generate-report@binary:
    cmd: printf "# Model report\n" > models/binary/report.md && printf "## Training\n"
      >> models/binary/report.md && printf "### Parameters\n" >> models/binary/report.md
      && printf '```yaml\n' >> models/binary/report.md && cat models/binary/config.yaml
      >> models/binary/report.md && printf '```\n' >> models/binary/report.md && printf
      "### Model architecture\n" >> models/binary/report.md && printf '```\n' >> models/binary/report.md
      && cat models/binary/model_summary.txt >> models/binary/report.md && printf
      '```\n' >> models/binary/report.md && printf "### Loss curve\n" >> models/binary/report.md
      && printf "![Loss curve](train_plots/loss_curve.png 'Loss curve')\n\n" >> models/binary/report.md
      && printf "### Accuracy curve\n" >> models/binary/report.md && printf "![Accuracy
      curve](train_plots/accuracy_curve.png 'Accuracy curve')\n\n" >> models/binary/report.md
      && printf "### Metadata\n" >> models/binary/report.md && printf '```yaml\n'
      >> models/binary/report.md && cat models/binary/metadata.yaml >> models/binary/report.md
      && printf '```\n' >> models/binary/report.md && printf "## Test\n" >> models/binary/report.md
      && printf "### Metrics\n" >> models/binary/report.md && dvc metrics show --show-md
      models/binary/metrics.yaml >> models/binary/report.md && printf "### Confusion
      matrix\n" >> models/binary/report.md && printf "![Confusion matrix](test_plots/confusion_matrix.png
      'Confusion matrix')\n\n" >> models/binary/report.md && printf "### ROC Curve\n"
      >> models/binary/report.md && printf "![ROC Curve](test_plots/roc_curve.png
      'ROC Curve')\n\n" >> models/binary/report.md && printf "### Test samples\n"
      >> models/binary/report.md && printf "![Test samples](test_plots/test_samples.png
      'Test samples')\n\n" >> models/binary/report.md
    deps:
    - path: models/binary/config.yaml
      md5: 1a3604eaed083c5b7b32c32fae023309
      size: 416
    - path: models/binary/metrics.yaml
      md5: 8338197163dc2f6a577045db94dff2b5
      size: 245
    - path: models/binary/model_summary.txt
      md5: 978717ff182a8abda1a95baef1a7b554
      size: 1831
    - path: models/binary/test_plots/
      md5: 7a95bf1e396c078b294d905a1547e2e7.dir
      size: 813339
      nfiles: 3
    - path: models/binary/train_plots/
      md5: 05ac4a43c043f18712aac9a69d35cb52.dir
      size: 90529
      nfiles: 2
    outs:
    - path: models/binary/report.md
      md5: 5872a793070724d510fc34f2b4b6c604
      size: 3518
  train@multiclass:
    cmd: python -m solarnet.main train +experiment=multiclass
    deps:
    - path: config/experiment/multiclass.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 220
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/config.yaml
      md5: db8330cb3cdd7c2c57cd7890aadf654b
      size: 454
    - path: models/multiclass/metadata.yaml
      md5: d46e1992618ef44cc2612928797ccc82
      size: 332
    - path: models/multiclass/model.ckpt
      md5: e3fbe93276ae2399d26c1c5970b40a5a
      size: 322071
    - path: models/multiclass/model_summary.txt
      md5: 51ab05082e75238f920a9437aa8efbe7
      size: 1809
    - path: models/multiclass/train_plots/
      md5: a69dc8bfb72ed8ac77a4eccd5c449c48.dir
      size: 103320
      nfiles: 2
  test@multiclass:
    cmd: python -m solarnet.main test +experiment=multiclass
    deps:
    - path: config/experiment/multiclass.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 220
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/multiclass/model.ckpt
      md5: e3fbe93276ae2399d26c1c5970b40a5a
      size: 322071
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/tasks/test.py
      md5: e6b52f4bd6de4376e21088a7f195524f
      size: 6355
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/metrics.yaml
      md5: d7886b8859af665dcc42e260b8ac22f1
      size: 221
    - path: models/multiclass/test_plots/
      md5: df6ac61cd94d9424c9f6ca276f0006da.dir
      size: 810040
      nfiles: 2
  generate-report@multiclass:
    cmd: printf "# Model report\n" > models/multiclass/report.md && printf "## Training\n"
      >> models/multiclass/report.md && printf "### Parameters\n" >> models/multiclass/report.md
      && printf '```yaml\n' >> models/multiclass/report.md && cat models/multiclass/config.yaml
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Model architecture\n" >> models/multiclass/report.md && printf
      '```\n' >> models/multiclass/report.md && cat models/multiclass/model_summary.txt
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Loss curve\n" >> models/multiclass/report.md && printf "![Loss
      curve](train_plots/loss_curve.png 'Loss curve')\n\n" >> models/multiclass/report.md
      && printf "### Accuracy curve\n" >> models/multiclass/report.md && printf "![Accuracy
      curve](train_plots/accuracy_curve.png 'Accuracy curve')\n\n" >> models/multiclass/report.md
      && printf "### Metadata\n" >> models/multiclass/report.md && printf '```yaml\n'
      >> models/multiclass/report.md && cat models/multiclass/metadata.yaml >> models/multiclass/report.md
      && printf '```\n' >> models/multiclass/report.md && printf "## Test\n" >> models/multiclass/report.md
      && printf "### Metrics\n" >> models/multiclass/report.md && dvc metrics show
      --show-md models/multiclass/metrics.yaml >> models/multiclass/report.md && printf
      "### Confusion matrix\n" >> models/multiclass/report.md && printf "![Confusion
      matrix](test_plots/confusion_matrix.png 'Confusion matrix')\n\n" >> models/multiclass/report.md
      && printf "### Test samples\n" >> models/multiclass/report.md && printf "![Test
      samples](test_plots/test_samples.png 'Test samples')\n\n" >> models/multiclass/report.md
    deps:
    - path: models/multiclass/config.yaml
      md5: db8330cb3cdd7c2c57cd7890aadf654b
      size: 454
    - path: models/multiclass/metrics.yaml
      md5: d7886b8859af665dcc42e260b8ac22f1
      size: 221
    - path: models/multiclass/model_summary.txt
      md5: 51ab05082e75238f920a9437aa8efbe7
      size: 1809
    - path: models/multiclass/test_plots/
      md5: df6ac61cd94d9424c9f6ca276f0006da.dir
      size: 810040
      nfiles: 2
    - path: models/multiclass/train_plots/
      md5: a69dc8bfb72ed8ac77a4eccd5c449c48.dir
      size: 103320
      nfiles: 2
    outs:
    - path: models/multiclass/report.md
      md5: 7bbcd63a374752e42d4970be6a588468
      size: 3444
  train@regression:
    cmd: python -m solarnet.main train +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 113
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 3028
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/config.yaml
      md5: 61d0368ab5997554d02de3f7acbc3069
      size: 361
    - path: models/regression/metadata.yaml
      md5: acd926b399f9c9ed99dc613f8330934c
      size: 331
    - path: models/regression/model.ckpt
      md5: 64af0398fada15a0709b229e34c29c98
      size: 321999
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1724
    - path: models/regression/train_plots/
      md5: d4cd6fcc352508ec535780a7950bc5ea.dir
      size: 38072
      nfiles: 1
  test@regression:
    cmd: python -m solarnet.main test +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 113
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/regression/model.ckpt
      md5: 64af0398fada15a0709b229e34c29c98
      size: 321999
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 3028
    - path: solarnet/tasks/test.py
      md5: e6b52f4bd6de4376e21088a7f195524f
      size: 6355
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/metrics.yaml
      md5: 8cd8c5777efc16664af025cacd237b7d
      size: 58
    - path: models/regression/test_plots/
      md5: 9831ca1f79a67f47cf38dc36e4bfb1af.dir
      size: 830812
      nfiles: 2
  generate-report@regression:
    cmd: printf "# Model report\n" > models/regression/report.md && printf "## Training\n"
      >> models/regression/report.md && printf "### Parameters\n" >> models/regression/report.md
      && printf '```yaml\n' >> models/regression/report.md && cat models/regression/config.yaml
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Model architecture\n" >> models/regression/report.md && printf
      '```\n' >> models/regression/report.md && cat models/regression/model_summary.txt
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Loss curve\n" >> models/regression/report.md && printf "![Loss
      curve](train_plots/loss_curve.png 'Loss curve')\n\n" >> models/regression/report.md
      && true && printf "### Metadata\n" >> models/regression/report.md && printf
      '```yaml\n' >> models/regression/report.md && cat models/regression/metadata.yaml
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "## Test\n" >> models/regression/report.md && printf "### Metrics\n"
      >> models/regression/report.md && dvc metrics show --show-md models/regression/metrics.yaml
      >> models/regression/report.md && printf "### Regression line\n" >> models/regression/report.md
      && printf "![Regression line](test_plots/regression_line.png 'Regression line')\n\n"
      >> models/regression/report.md && printf "### Test samples\n" >> models/regression/report.md
      && printf "![Test samples](test_plots/test_samples.png 'Test samples')\n\n"
      >> models/regression/report.md
    deps:
    - path: models/regression/config.yaml
      md5: 61d0368ab5997554d02de3f7acbc3069
      size: 361
    - path: models/regression/metrics.yaml
      md5: 8cd8c5777efc16664af025cacd237b7d
      size: 58
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1724
    - path: models/regression/test_plots/
      md5: 9831ca1f79a67f47cf38dc36e4bfb1af.dir
      size: 830812
      nfiles: 2
    - path: models/regression/train_plots/
      md5: d4cd6fcc352508ec535780a7950bc5ea.dir
      size: 38072
      nfiles: 1
    outs:
    - path: models/regression/report.md
      md5: c882208c3a447d7bac2ec95b40b0836d
      size: 2943
  test@binary_sdodataset:
    cmd: python -m solarnet.main test +experiment=binary_sdodataset
    deps:
    - path: config/experiment/binary_sdodataset.yaml
      md5: 3f1e40f1f1f6ca2f5e625f7996d4008e
      size: 143
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary_sdodataset/model.ckpt
      md5: 213c3dd5e817c3513b64d2f9155c1382
      size: 326996
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 2aec85f75a53bd4e5fba44a2f7928573
      size: 5628
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary_sdodataset/confusion_matrix.png
      md5: 46e955e4edc5aab8bb8ae1417d92a772
      size: 22090
    - path: models/binary_sdodataset/metrics.yaml
      md5: c7c6dbcba1c9cfacb82767817ab8cc4a
      size: 212
    - path: models/binary_sdodataset/test_samples.png
      md5: cf77093d1a1006302304557f55c8695b
      size: 431985
  train@binary_sdodataset:
    cmd: python -m solarnet.main train +experiment=binary_sdodataset
    deps:
    - path: config/experiment/binary_sdodataset.yaml
      md5: 3f1e40f1f1f6ca2f5e625f7996d4008e
      size: 143
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: ae503c50e236766b345d3403e4102d34
      size: 3199
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: 05894cb899be21c19105ff28a8306879
      size: 3436
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary_sdodataset/config.yaml
      md5: 220b55374388344a14fb09fe548ec7f1
      size: 369
    - path: models/binary_sdodataset/history.png
      md5: e3f48599f537c7f0d6b93ff9050de371
      size: 41440
    - path: models/binary_sdodataset/metadata.yaml
      md5: 5f1183814a0bf69ada2c2a573a5a97c7
      size: 348
    - path: models/binary_sdodataset/model.ckpt
      md5: 213c3dd5e817c3513b64d2f9155c1382
      size: 326996
    - path: models/binary_sdodataset/model_summary.txt
      md5: f4659c7295d32e213ae8135fc795071c
      size: 1702
  generate-report@binary_sdodataset:
    cmd: printf "# Model report\n" > models/binary_sdodataset/report.md && printf
      "## Training\n" >> models/binary_sdodataset/report.md && printf "### Parameters\n"
      >> models/binary_sdodataset/report.md && printf '```yaml\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/config.yaml >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "### Model
      architecture\n" >> models/binary_sdodataset/report.md && printf '```\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/model_summary.txt >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "### Loss
      curve\n" >> models/binary_sdodataset/report.md && printf "![Loss curve](history.png
      'Loss curve')\n\n" >> models/binary_sdodataset/report.md && printf "### Metadata\n"
      >> models/binary_sdodataset/report.md && printf '```yaml\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/metadata.yaml >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "## Test\n"
      >> models/binary_sdodataset/report.md && printf "### Metrics\n" >> models/binary_sdodataset/report.md
      && dvc metrics show --show-md models/binary_sdodataset/metrics.yaml >> models/binary_sdodataset/report.md
      && printf "### Confusion matrix\n" >> models/binary_sdodataset/report.md &&
      printf "![Confusion matrix](confusion_matrix.png 'Confusion matrix')\n\n" >>
      models/binary_sdodataset/report.md && printf "### Test samples\n" >> models/binary_sdodataset/report.md
      && printf "![Test samples](test_samples.png 'Test samples')\n\n" >> models/binary_sdodataset/report.md
    deps:
    - path: models/binary_sdodataset/config.yaml
      md5: 220b55374388344a14fb09fe548ec7f1
      size: 369
    - path: models/binary_sdodataset/confusion_matrix.png
      md5: 46e955e4edc5aab8bb8ae1417d92a772
      size: 22090
    - path: models/binary_sdodataset/history.png
      md5: e3f48599f537c7f0d6b93ff9050de371
      size: 41440
    - path: models/binary_sdodataset/metrics.yaml
      md5: c7c6dbcba1c9cfacb82767817ab8cc4a
      size: 212
    - path: models/binary_sdodataset/model_summary.txt
      md5: f4659c7295d32e213ae8135fc795071c
      size: 1702
    - path: models/binary_sdodataset/test_samples.png
      md5: cf77093d1a1006302304557f55c8695b
      size: 431985
    outs:
    - path: models/binary_sdodataset/report.md
      md5: 199e245bd310a92edd1dc0441be13bf5
      size: 3161
