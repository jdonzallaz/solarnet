schema: '2.0'
stages:
  download-dataset:
    cmd: python -m solarnet.main download sdo-benchmark-zip
    deps:
    - path: config/minio.yaml
      md5: 2cf2c6bc04bcddb76df1d97aae80ba0a
      size: 117
    outs:
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
  train@binary:
    cmd: python -m solarnet.main train +experiment=binary
    deps:
    - path: config/experiment/binary.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 61
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/config.yaml
      md5: 1a3604eaed083c5b7b32c32fae023309
      size: 416
    - path: models/binary/metadata.yaml
      md5: ebf109c16130200b6789c1d2c9eab24a
      size: 332
    - path: models/binary/model.ckpt
      md5: 18848b95483caa980762a7b52af3f21c
      size: 321751
    - path: models/binary/model_summary.txt
      md5: 978717ff182a8abda1a95baef1a7b554
      size: 1831
    - path: models/binary/train_plots/
      md5: 05ac4a43c043f18712aac9a69d35cb52.dir
      size: 90529
      nfiles: 2
  test@binary:
    cmd: python -m solarnet.main test +experiment=binary
    deps:
    - path: config/experiment/binary.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary/model.ckpt
      md5: 18848b95483caa980762a7b52af3f21c
      size: 321751
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 88f9a59e7981de604b1ed0ff163fd64c
      size: 7153
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/metrics.yaml
      md5: 8338197163dc2f6a577045db94dff2b5
      size: 236
    - path: models/binary/test_plots/
      md5: 7f051d42213325232e44f33665b7f88b.dir
      size: 847539
      nfiles: 3
  generate-report@binary:
    cmd: printf "# Model report\n" > models/binary/report.md && printf "## Training\n"
      >> models/binary/report.md && printf "### Parameters\n" >> models/binary/report.md
      && printf '```yaml\n' >> models/binary/report.md && cat models/binary/config.yaml
      >> models/binary/report.md && printf '```\n' >> models/binary/report.md && printf
      "### Model architecture\n" >> models/binary/report.md && printf '```\n' >> models/binary/report.md
      && cat models/binary/model_summary.txt >> models/binary/report.md && printf
      '```\n' >> models/binary/report.md && printf "### Loss curve\n" >> models/binary/report.md
      && printf "![Loss curve](train_plots/loss_curve.png 'Loss curve')\n\n" >> models/binary/report.md
      && printf "### Accuracy curve\n" >> models/binary/report.md && printf "![Accuracy
      curve](train_plots/accuracy_curve.png 'Accuracy curve')\n\n" >> models/binary/report.md
      && printf "### Metadata\n" >> models/binary/report.md && printf '```yaml\n'
      >> models/binary/report.md && cat models/binary/metadata.yaml >> models/binary/report.md
      && printf '```\n' >> models/binary/report.md && printf "## Test\n" >> models/binary/report.md
      && printf "### Metrics\n" >> models/binary/report.md && dvc metrics show --show-md
      models/binary/metrics.yaml >> models/binary/report.md && printf "### Confusion
      matrix\n" >> models/binary/report.md && printf "![Confusion matrix](test_plots/confusion_matrix.png
      'Confusion matrix')\n\n" >> models/binary/report.md && printf "### ROC Curve\n"
      >> models/binary/report.md && printf "![ROC Curve](test_plots/roc_curve.png
      'ROC Curve')\n\n" >> models/binary/report.md && printf "### Test samples\n"
      >> models/binary/report.md && printf "![Test samples](test_plots/test_samples.png
      'Test samples')\n\n" >> models/binary/report.md
    deps:
    - path: models/binary/config.yaml
      md5: 1a3604eaed083c5b7b32c32fae023309
      size: 392
    - path: models/binary/metrics.yaml
      md5: 8338197163dc2f6a577045db94dff2b5
      size: 236
    - path: models/binary/model_summary.txt
      md5: 978717ff182a8abda1a95baef1a7b554
      size: 1783
    - path: models/binary/test_plots/
      md5: 7f051d42213325232e44f33665b7f88b.dir
      size: 847539
      nfiles: 3
    - path: models/binary/train_plots/
      md5: 05ac4a43c043f18712aac9a69d35cb52.dir
      size: 90529
      nfiles: 2
    outs:
    - path: models/binary/report.md
      md5: 4222da4ca5ba55cdbe92cccf3761fbea
      size: 3431
  train@multiclass:
    cmd: python -m solarnet.main train +experiment=multiclass
    deps:
    - path: config/experiment/multiclass.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 220
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/config.yaml
      md5: db8330cb3cdd7c2c57cd7890aadf654b
      size: 454
    - path: models/multiclass/metadata.yaml
      md5: d46e1992618ef44cc2612928797ccc82
      size: 332
    - path: models/multiclass/model.ckpt
      md5: e3fbe93276ae2399d26c1c5970b40a5a
      size: 322071
    - path: models/multiclass/model_summary.txt
      md5: 51ab05082e75238f920a9437aa8efbe7
      size: 1809
    - path: models/multiclass/train_plots/
      md5: a69dc8bfb72ed8ac77a4eccd5c449c48.dir
      size: 103320
      nfiles: 2
  test@multiclass:
    cmd: python -m solarnet.main test +experiment=multiclass
    deps:
    - path: config/experiment/multiclass.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/multiclass/model.ckpt
      md5: e3fbe93276ae2399d26c1c5970b40a5a
      size: 322071
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 88f9a59e7981de604b1ed0ff163fd64c
      size: 7153
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/metrics.yaml
      md5: d7886b8859af665dcc42e260b8ac22f1
      size: 213
    - path: models/multiclass/test_plots/
      md5: 6ebbe90664c6ad211da68bb28bc99ecc.dir
      size: 878258
      nfiles: 2
  generate-report@multiclass:
    cmd: printf "# Model report\n" > models/multiclass/report.md && printf "## Training\n"
      >> models/multiclass/report.md && printf "### Parameters\n" >> models/multiclass/report.md
      && printf '```yaml\n' >> models/multiclass/report.md && cat models/multiclass/config.yaml
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Model architecture\n" >> models/multiclass/report.md && printf
      '```\n' >> models/multiclass/report.md && cat models/multiclass/model_summary.txt
      >> models/multiclass/report.md && printf '```\n' >> models/multiclass/report.md
      && printf "### Loss curve\n" >> models/multiclass/report.md && printf "![Loss
      curve](train_plots/loss_curve.png 'Loss curve')\n\n" >> models/multiclass/report.md
      && printf "### Accuracy curve\n" >> models/multiclass/report.md && printf "![Accuracy
      curve](train_plots/accuracy_curve.png 'Accuracy curve')\n\n" >> models/multiclass/report.md
      && printf "### Metadata\n" >> models/multiclass/report.md && printf '```yaml\n'
      >> models/multiclass/report.md && cat models/multiclass/metadata.yaml >> models/multiclass/report.md
      && printf '```\n' >> models/multiclass/report.md && printf "## Test\n" >> models/multiclass/report.md
      && printf "### Metrics\n" >> models/multiclass/report.md && dvc metrics show
      --show-md models/multiclass/metrics.yaml >> models/multiclass/report.md && printf
      "### Confusion matrix\n" >> models/multiclass/report.md && printf "![Confusion
      matrix](test_plots/confusion_matrix.png 'Confusion matrix')\n\n" >> models/multiclass/report.md
      && printf "### Test samples\n" >> models/multiclass/report.md && printf "![Test
      samples](test_plots/test_samples.png 'Test samples')\n\n" >> models/multiclass/report.md
    deps:
    - path: models/multiclass/config.yaml
      md5: db8330cb3cdd7c2c57cd7890aadf654b
      size: 428
    - path: models/multiclass/metrics.yaml
      md5: d7886b8859af665dcc42e260b8ac22f1
      size: 213
    - path: models/multiclass/model_summary.txt
      md5: 51ab05082e75238f920a9437aa8efbe7
      size: 1762
    - path: models/multiclass/test_plots/
      md5: 6ebbe90664c6ad211da68bb28bc99ecc.dir
      size: 878258
      nfiles: 2
    - path: models/multiclass/train_plots/
      md5: a69dc8bfb72ed8ac77a4eccd5c449c48.dir
      size: 103320
      nfiles: 2
    outs:
    - path: models/multiclass/report.md
      md5: 429464699a49910093e909eb9a065f05
      size: 3356
  train@regression:
    cmd: python -m solarnet.main train +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 113
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1830
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 3028
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/config.yaml
      md5: 61d0368ab5997554d02de3f7acbc3069
      size: 361
    - path: models/regression/metadata.yaml
      md5: acd926b399f9c9ed99dc613f8330934c
      size: 331
    - path: models/regression/model.ckpt
      md5: 64af0398fada15a0709b229e34c29c98
      size: 321999
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1724
    - path: models/regression/train_plots/
      md5: d4cd6fcc352508ec535780a7950bc5ea.dir
      size: 38072
      nfiles: 1
  test@regression:
    cmd: python -m solarnet.main test +experiment=regression
    deps:
    - path: config/experiment/regression.yaml
      md5: e0a2b69e4f4c731b8967a9053e28dad9
      size: 106
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/regression/model.ckpt
      md5: 64af0398fada15a0709b229e34c29c98
      size: 321999
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/models/cnn_regression.py
      md5: e82c034188e4e34f06d4c0fd83cc09f3
      size: 2944
    - path: solarnet/tasks/test.py
      md5: 88f9a59e7981de604b1ed0ff163fd64c
      size: 7153
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/regression/metrics.yaml
      md5: 2fef192ddd2c5a43c29ab46f3ce0d63a
      size: 54
    - path: models/regression/test_plots/
      md5: f143297f5db973318e3390481847565e.dir
      size: 827226
      nfiles: 2
  generate-report@regression:
    cmd: printf "# Model report\n" > models/regression/report.md && printf "## Training\n"
      >> models/regression/report.md && printf "### Parameters\n" >> models/regression/report.md
      && printf '```yaml\n' >> models/regression/report.md && cat models/regression/config.yaml
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Model architecture\n" >> models/regression/report.md && printf
      '```\n' >> models/regression/report.md && cat models/regression/model_summary.txt
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "### Loss curve\n" >> models/regression/report.md && printf "![Loss
      curve](train_plots/loss_curve.png 'Loss curve')\n\n" >> models/regression/report.md
      && true && printf "### Metadata\n" >> models/regression/report.md && printf
      '```yaml\n' >> models/regression/report.md && cat models/regression/metadata.yaml
      >> models/regression/report.md && printf '```\n' >> models/regression/report.md
      && printf "## Test\n" >> models/regression/report.md && printf "### Metrics\n"
      >> models/regression/report.md && dvc metrics show --show-md models/regression/metrics.yaml
      >> models/regression/report.md && printf "### Regression line\n" >> models/regression/report.md
      && printf "![Regression line](test_plots/regression_line.png 'Regression line')\n\n"
      >> models/regression/report.md && printf "### Test samples\n" >> models/regression/report.md
      && printf "![Test samples](test_plots/test_samples.png 'Test samples')\n\n"
      >> models/regression/report.md
    deps:
    - path: models/regression/config.yaml
      md5: 61d0368ab5997554d02de3f7acbc3069
      size: 340
    - path: models/regression/metrics.yaml
      md5: 2fef192ddd2c5a43c29ab46f3ce0d63a
      size: 54
    - path: models/regression/model_summary.txt
      md5: 62ab02cfe8d9a07c728765f49baaa541
      size: 1681
    - path: models/regression/test_plots/
      md5: f143297f5db973318e3390481847565e.dir
      size: 827226
      nfiles: 2
    - path: models/regression/train_plots/
      md5: d4cd6fcc352508ec535780a7950bc5ea.dir
      size: 38072
      nfiles: 1
    outs:
    - path: models/regression/report.md
      md5: 0acf1542b72a39fbc051556705f2d554
      size: 2864
  test@binary_sdodataset:
    cmd: python -m solarnet.main test +experiment=binary_sdodataset
    deps:
    - path: config/experiment/binary_sdodataset.yaml
      md5: a2abc668908eb7e9b55974135d2647dc
      size: 207
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary_sdodataset/model.ckpt
      md5: c1ca246ef112b97d8c0a59ef38d6b5cc
      size: 327124
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/test.py
      md5: 88f9a59e7981de604b1ed0ff163fd64c
      size: 7153
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary_sdodataset/metrics.yaml
      md5: 19fe8c52348a86d4dfe23ce128b68449
      size: 239
    - path: models/binary_sdodataset/test_plots/
      md5: 907ced6466680c86c84caed1aaccb26f.dir
      size: 546054
      nfiles: 3
  train@binary_sdodataset:
    cmd: python -m solarnet.main train +experiment=binary_sdodataset
    deps:
    - path: config/experiment/binary_sdodataset.yaml
      md5: a2abc668908eb7e9b55974135d2647dc
      size: 207
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/cnn_classification.py
      md5: c1b30dbc240f693544944daa7989722e
      size: 3633
    - path: solarnet/models/cnn_module.py
      md5: ead31bd3b8f3e956b9630234c1e6b693
      size: 1776
    - path: solarnet/tasks/train.py
      md5: 6b0b09adfd1467c291e73232fa66869c
      size: 4014
    params:
      config/config.yaml:
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary_sdodataset/config.yaml
      md5: f9f5b73b072596b0fe33ace1bcc7f744
      size: 373
    - path: models/binary_sdodataset/metadata.yaml
      md5: 18698a00fe9beef38bee2c4ff30be902
      size: 348
    - path: models/binary_sdodataset/model.ckpt
      md5: c1ca246ef112b97d8c0a59ef38d6b5cc
      size: 327124
    - path: models/binary_sdodataset/model_summary.txt
      md5: bdba2aafa02c1809ec0ef9fb6d855fd5
      size: 1852
    - path: models/binary_sdodataset/train_plots/
      md5: 474045816fe16aeb427e2871bc7c9ce6.dir
      size: 85188
      nfiles: 2
  generate-report@binary_sdodataset:
    cmd: printf "# Model report\n" > models/binary_sdodataset/report.md && printf
      "## Training\n" >> models/binary_sdodataset/report.md && printf "### Parameters\n"
      >> models/binary_sdodataset/report.md && printf '```yaml\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/config.yaml >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "### Model
      architecture\n" >> models/binary_sdodataset/report.md && printf '```\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/model_summary.txt >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "### Loss
      curve\n" >> models/binary_sdodataset/report.md && printf "![Loss curve](train_plots/loss_curve.png
      'Loss curve')\n\n" >> models/binary_sdodataset/report.md && printf "### Accuracy
      curve\n" >> models/binary_sdodataset/report.md && printf "![Accuracy curve](train_plots/accuracy_curve.png
      'Accuracy curve')\n\n" >> models/binary_sdodataset/report.md && printf "###
      Metadata\n" >> models/binary_sdodataset/report.md && printf '```yaml\n' >> models/binary_sdodataset/report.md
      && cat models/binary_sdodataset/metadata.yaml >> models/binary_sdodataset/report.md
      && printf '```\n' >> models/binary_sdodataset/report.md && printf "## Test\n"
      >> models/binary_sdodataset/report.md && printf "### Metrics\n" >> models/binary_sdodataset/report.md
      && dvc metrics show --show-md models/binary_sdodataset/metrics.yaml >> models/binary_sdodataset/report.md
      && printf "### Confusion matrix\n" >> models/binary_sdodataset/report.md &&
      printf "![Confusion matrix](test_plots/confusion_matrix.png 'Confusion matrix')\n\n"
      >> models/binary_sdodataset/report.md && printf "### ROC Curve\n" >> models/binary_sdodataset/report.md
      && printf "![ROC Curve](test_plots/roc_curve.png 'ROC Curve')\n\n" >> models/binary_sdodataset/report.md
      && printf "### Test samples\n" >> models/binary_sdodataset/report.md && printf
      "![Test samples](test_plots/test_samples.png 'Test samples')\n\n" >> models/binary_sdodataset/report.md
    deps:
    - path: models/binary_sdodataset/config.yaml
      md5: f9f5b73b072596b0fe33ace1bcc7f744
      size: 373
    - path: models/binary_sdodataset/metrics.yaml
      md5: 19fe8c52348a86d4dfe23ce128b68449
      size: 239
    - path: models/binary_sdodataset/model_summary.txt
      md5: bdba2aafa02c1809ec0ef9fb6d855fd5
      size: 1852
    - path: models/binary_sdodataset/test_plots/
      md5: 907ced6466680c86c84caed1aaccb26f.dir
      size: 546054
      nfiles: 3
    - path: models/binary_sdodataset/train_plots/
      md5: 474045816fe16aeb427e2871bc7c9ce6.dir
      size: 85188
      nfiles: 2
    outs:
    - path: models/binary_sdodataset/report.md
      md5: 96299a933233906912498f1ecf9f0133
      size: 3538
