schema: '2.0'
stages:
  download-dataset:
    cmd: python -m solarnet.main download sdo-benchmark-zip
    deps:
    - path: config/minio.yaml
      md5: 2cf2c6bc04bcddb76df1d97aae80ba0a
      size: 117
    outs:
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
  train@binary:
    cmd: python -m solarnet.main train +experiment=binary_classification
    deps:
    - path: config/experiment/binary_classification.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/baseline.py
      md5: 4d5632d2f513677fb49937a3fc44c602
      size: 6425
    - path: solarnet/tasks/train.py
      md5: 62ecb0065fc48c7e8bfd8b3ddb76c72c
      size: 4200
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/history.png
      md5: c3a4fa3d765e5e97815e1df76c7899ea
      size: 52730
    - path: models/binary/model.ckpt
      md5: e0399de8cc284183f79b83ebda85328b
      size: 321431
    - path: models/binary/model_summary.txt
      md5: ea4d0736a2ad363d42b9d70caf6f186d
      size: 1643
  test@binary:
    cmd: python -m solarnet.main test +experiment=binary_classification
    deps:
    - path: config/experiment/binary_classification.yaml
      md5: 939b8a7c696a6036e1aeeff3364c13c1
      size: 58
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/binary/model.ckpt
      md5: e0399de8cc284183f79b83ebda85328b
      size: 321431
    - path: solarnet/models/baseline.py
      md5: 4d5632d2f513677fb49937a3fc44c602
      size: 6425
    - path: solarnet/tasks/test.py
      md5: 6bd3233e08e649ea0ffe7288ce1baf5d
      size: 5965
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/binary/confusion_matrix.png
      md5: ca6a17cd58ebc08e8a1d9dfb3aa2de66
      size: 22112
    - path: models/binary/metrics.yaml
      md5: 3ae4b80c47155e0cc944ebcae0f1a427
      size: 217
    - path: models/binary/test_samples.png
      md5: 0bbc632b1638ea51a66987b89b258b3c
      size: 756230
  generate-report@binary:
    cmd: printf "# Model report\n" > models/binary/report.md && printf "## Training\n"
      >> models/binary/report.md && printf "### Parameters\n" >> models/binary/report.md
      && printf "```yaml\n" >> models/binary/report.md && cat models/binary/config.yaml
      >> models/binary/report.md && printf "```\n" >> models/binary/report.md && printf
      "### Model architecture\n" >> models/binary/report.md && printf "```\n" >> models/binary/report.md
      && cat models/binary/model_summary.txt >> models/binary/report.md && printf
      "```\n" >> models/binary/report.md && printf "### Loss curve\n" >> models/binary/report.md
      && printf "![Loss curve](history.png 'Loss curve')\n\n" >> models/binary/report.md
      && printf "## Test\n" >> models/binary/report.md && printf "### Metrics\n" >>
      models/binary/report.md && dvc metrics show --show-md models/binary/metrics.yaml
      >> models/binary/report.md && printf "### Confusion matrix\n" >> models/binary/report.md
      && printf "![Confusion matrix](confusion_matrix.png 'Confusion matrix')\n\n"
      >> models/binary/report.md && printf "### Test samples\n" >> models/binary/report.md
      && printf "![Test samples](test_samples.png 'Test samples')\n\n" >> models/binary/report.md
    deps:
    - path: models/binary/config.yaml
      md5: c15096d09d027b92c186c5909fc6a39c
      size: 365
    - path: models/binary/confusion_matrix.png
      md5: ca6a17cd58ebc08e8a1d9dfb3aa2de66
      size: 22112
    - path: models/binary/history.png
      md5: c3a4fa3d765e5e97815e1df76c7899ea
      size: 52730
    - path: models/binary/metrics.yaml
      md5: 3ae4b80c47155e0cc944ebcae0f1a427
      size: 217
    - path: models/binary/model_summary.txt
      md5: ea4d0736a2ad363d42b9d70caf6f186d
      size: 1643
    - path: models/binary/test_samples.png
      md5: 0bbc632b1638ea51a66987b89b258b3c
      size: 756230
    outs:
    - path: models/binary/report.md
      md5: e7f58224d0c7f58db3c76be803bec676
      size: 2702
  train@multiclass:
    cmd: python -m solarnet.main train +experiment=multiclass_classification
    deps:
    - path: config/experiment/multiclass_classification.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: solarnet/models/baseline.py
      md5: 4d5632d2f513677fb49937a3fc44c602
      size: 6425
    - path: solarnet/tasks/train.py
      md5: 62ecb0065fc48c7e8bfd8b3ddb76c72c
      size: 4200
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        name: Baseline binary classification model
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/history.png
      md5: ef5563efa8598f48f7ac2effdf5f860e
      size: 33787
    - path: models/multiclass/model.ckpt
      md5: f58231ab559ae0c33b3bd304006d44eb
      size: 321815
    - path: models/multiclass/model_summary.txt
      md5: 2651cfdcf7ac9b75a0bb7278b9e927b2
      size: 1643
  test@multiclass:
    cmd: python -m solarnet.main test +experiment=multiclass_classification
    deps:
    - path: config/experiment/multiclass_classification.yaml
      md5: 002b003ae6fca6d8b3b3732c667fbfc1
      size: 208
    - path: data/sdo-benchmark.placeholder
      md5: 03bc278e4376c8585af17fe4557b0337
      size: 162
    - path: models/multiclass/model.ckpt
      md5: f58231ab559ae0c33b3bd304006d44eb
      size: 321815
    - path: solarnet/models/baseline.py
      md5: 4d5632d2f513677fb49937a3fc44c602
      size: 6425
    - path: solarnet/tasks/test.py
      md5: 6bd3233e08e649ea0ffe7288ce1baf5d
      size: 5965
    params:
      config/config.yaml:
        data:
          validation_size: 0.1
          channel: 211
          size: 256
          targets:
            classes:
            - Quiet: < 1e-6
            - '>=C': '>= 1e-6'
          time_steps:
          - 3
        gpus: 1
        model:
          activation: relu6
        seed: 42
        tracking: true
        trainer:
          epochs: 20
          batch_size: 128
          learning_rate: 0.005
          patience: 12
    outs:
    - path: models/multiclass/confusion_matrix.png
      md5: 14f9d787bc2ae78488391fbae1afda42
      size: 43582
    - path: models/multiclass/metrics.yaml
      md5: 2cbffdbdc7933660269f627cd479ea1c
      size: 219
    - path: models/multiclass/test_samples.png
      md5: 185c6c57f59b96c5bbd2fdd6a34f7889
      size: 760844
  generate-report@multiclass:
    cmd: printf "# Model report\n" > models/multiclass/report.md && printf "## Training\n"
      >> models/multiclass/report.md && printf "### Parameters\n" >> models/multiclass/report.md
      && printf "```yaml\n" >> models/multiclass/report.md && cat models/multiclass/config.yaml
      >> models/multiclass/report.md && printf "```\n" >> models/multiclass/report.md
      && printf "### Model architecture\n" >> models/multiclass/report.md && printf
      "```\n" >> models/multiclass/report.md && cat models/multiclass/model_summary.txt
      >> models/multiclass/report.md && printf "```\n" >> models/multiclass/report.md
      && printf "### Loss curve\n" >> models/multiclass/report.md && printf "![Loss
      curve](history.png 'Loss curve')\n\n" >> models/multiclass/report.md && printf
      "## Test\n" >> models/multiclass/report.md && printf "### Metrics\n" >> models/multiclass/report.md
      && dvc metrics show --show-md models/multiclass/metrics.yaml >> models/multiclass/report.md
      && printf "### Confusion matrix\n" >> models/multiclass/report.md && printf
      "![Confusion matrix](confusion_matrix.png 'Confusion matrix')\n\n" >> models/multiclass/report.md
      && printf "### Test samples\n" >> models/multiclass/report.md && printf "![Test
      samples](test_samples.png 'Test samples')\n\n" >> models/multiclass/report.md
    deps:
    - path: models/multiclass/config.yaml
      md5: 391f3b5da41eab5cb94a84e6281e92d0
      size: 403
    - path: models/multiclass/confusion_matrix.png
      md5: 14f9d787bc2ae78488391fbae1afda42
      size: 43582
    - path: models/multiclass/history.png
      md5: ef5563efa8598f48f7ac2effdf5f860e
      size: 33787
    - path: models/multiclass/metrics.yaml
      md5: 2cbffdbdc7933660269f627cd479ea1c
      size: 219
    - path: models/multiclass/model_summary.txt
      md5: 2651cfdcf7ac9b75a0bb7278b9e927b2
      size: 1643
    - path: models/multiclass/test_samples.png
      md5: 185c6c57f59b96c5bbd2fdd6a34f7889
      size: 760844
    outs:
    - path: models/multiclass/report.md
      md5: f40ab2f0d4b519e502d3436440c92274
      size: 2752
